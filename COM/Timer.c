/***************************************************************************************************
*FileName:Timer
*Description:用作程序的计时器
*Author:xsx
*Data: 2016年5月14日15:49:39
***************************************************************************************************/

/***************************************************************************************************/
/******************************************头文件***************************************************/
/***************************************************************************************************/
#include	"Timer.h"

/***************************************************************************************************/
/**************************************局部变量声明*************************************************/
/***************************************************************************************************/
unsigned int GB_ClockTime = 1;													//计时器的时基

/***************************************************************************************************/
/**************************************局部函数声明*************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************正文********************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************
*FunctionName：timer_set
*Description：初始化一个定时器
*Input：t -- 待初始化的定时器
*		interval -- 定时器计时时间（秒）
*Output：None
*Author：xsx
*Data：2016年5月14日16:03:58
***************************************************************************************************/
void timer_SetAndStart(Timer *t, unsigned int interval)
{
	t->interval = interval;

	t->start = GB_ClockTime;
}

/***************************************************************************************************
*FunctionName：timer_restart
*Description：重启定时器
*Input：None
*Output：None
*Author：xsx
*Data：2016年5月14日16:05:25
***************************************************************************************************/
void timer_restart(Timer *t)
{
	t->start = GB_ClockTime;
}

/***************************************************************************************************
*FunctionName：timer_expired
*Description：判断计时时间是否到达
*Input：None
*Output：None
*Author：xsx
*Data：2016年5月14日16:08:55
***************************************************************************************************/
TimerStatus timer_expired(Timer *t)
{
	if(t)
	{
		if(t->start == 0)
			return TimerStopped;
		
		if((GB_ClockTime - t->start) >= t->interval)
			return TimerOut;
		else
			return TimerDowning;
	}
	
	return TimerError;
}

/***************************************************************************************************
*FunctionName：timer_surplus
*Description：读取计时器还需多久到达计时时间
*Input：None
*Output：None
*Author：xsx
*Data：2016年5月14日16:13:40
***************************************************************************************************/
unsigned int timer_surplus(Timer *t)
{
	if(t)
	{
		if((t->interval + t->start) > GB_ClockTime)
			return (t->interval - (GB_ClockTime - t->start));
		else
			return 0;
	}
	
	return 0xffffff;
}

/***************************************************************************************************
*FunctionName: timer_Count
*Description: 计时器已经计时多久
*Input: 
*Output: 
*Return: 
*Author: xsx
*Date: 2017年8月16日 14:26:38
***************************************************************************************************/
unsigned int timer_Count(Timer *t)
{
	if(t)
	{
		if((t->start > 0) && (GB_ClockTime > t->start))
			return (GB_ClockTime - t->start);
		else
			return 0;
	}
	
	return 0;
}

/***************************************************************************************************
*FunctionName: timerIsStartted
*Description: 判断定时器是否已经启动
*Input: 
*Output: 
*Return: 
*Author: xsx
*Date: 2016年12月8日16:27:47
***************************************************************************************************/
bool timerIsStartted(Timer * t)
{
	if(t)
	{
		if(t->start == 0)
			return false;
		else
			return true;
	}
	
	return false;
}

unsigned int getClockValue(void)
{
	return GB_ClockTime;
}

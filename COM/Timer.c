/***************************************************************************************************
*FileName:Timer_Data
*Description:ÓÃ×÷³ÌĞòµÄ¼ÆÊ±Æ÷
*Author:xsx
*Data: 2016Äê5ÔÂ14ÈÕ15:49:39
***************************************************************************************************/

/***************************************************************************************************/
/******************************************Í·ÎÄ¼ş***************************************************/
/***************************************************************************************************/
#include	"Timer.h"

/***************************************************************************************************/
/**************************************¾Ö²¿±äÁ¿ÉùÃ÷*************************************************/
/***************************************************************************************************/
unsigned int GB_ClockTime = 0;													//¼ÆÊ±Æ÷µÄÊ±»ù

/***************************************************************************************************/
/**************************************¾Ö²¿º¯ÊıÉùÃ÷*************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************ÕıÎÄ********************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************
*FunctionName£ResetGBClockTimeº
*Description£ºÖØÆô¼ÆÊ±Æ÷µÄÊ±»ù£¬¿ÉÔÚÃ»ÓĞ²âÊÔÈÎÎñÊÇµ÷ÓÃ£¬Ò²¿É²»ÓÃ£¬unsigned int×î³¤¼ÆÊ±Ê±¼äÎª4294967295 S
*				 µÈÓÚ3268Äê
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:17:31
***************************************************************************************************/
void ResetGBClockTime(void)
{
	GB_ClockTime = 0;
}

unsigned int getGBClockTime(void)
{
	return GB_ClockTime;
}

/***************************************************************************************************
*FunctionName£ºtimer_set
*Description£º³õÊ¼»¯Ò»¸ö¶¨Ê±Æ÷
*Input£ºt -- ´ı³õÊ¼»¯µÄ¶¨Ê±Æ÷
*		interval -- ¶¨Ê±Æ÷¼ÆÊ±Ê±¼ä£¨Ãë£©
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:03:58
***************************************************************************************************/
void timer_set(Timer *t, unsigned int interval)
{
  t->interval = interval;
  t->start = GB_ClockTime;
}

/***************************************************************************************************
*FunctionName: timer_stop
*Description: Í£Ö¹¶¨Ê±Æ÷
*Input: 
*Output: 
*Return: 
*Author: xsx
*Date: 2017Äê3ÔÂ10ÈÕ09:36:03
***************************************************************************************************/
void timer_stop(Timer *t)
{
  t->start = 0;
}

/***************************************************************************************************
*FunctionName£ºtimer_reset
*Description£ºÖØÖÃ¶¨Ê±Æ÷
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:04:51
***************************************************************************************************/
void timer_reset(Timer *t)
{
  t->start += t->interval;
}

/***************************************************************************************************
*FunctionName£ºtimer_restart
*Description£ºÖØÆô¶¨Ê±Æ÷
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:05:25
***************************************************************************************************/
void timer_restart(Timer *t)
{
  t->start = GB_ClockTime;
}

/***************************************************************************************************
*FunctionName£ºtimer_expired
*Description£ºÅĞ¶Ï¼ÆÊ±Ê±¼äÊÇ·ñµ½´ï
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:08:55
***************************************************************************************************/
TimerState_Def timer_expired(Timer *t)
{
	if(t)
	{
		if(timerIsStartted(t))
		{
			if((GB_ClockTime - t->start) >= t->interval)
				return TimeOut;
			else
				return TimeNotTo;
		}
	}
	
	return TimeError;
}

/***************************************************************************************************
*FunctionName£ºtimer_surplus
*Description£º¶ÁÈ¡¼ÆÊ±Æ÷»¹Ğè¶à¾Ãµ½´ï¼ÆÊ±Ê±¼ä
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:13:40
***************************************************************************************************/
unsigned int timer_surplus(Timer *t)
{
	if(t)
	{
		if(timerIsStartted(t))
		{
			if((t->interval + t->start) > GB_ClockTime)
				return (t->interval - (GB_ClockTime - t->start));
			else
				return 0;
		}
	}
	
	return 0xffffff;
}

/***************************************************************************************************
*FunctionName£ºtimer_used
*Description£º¶ÁÈ¡ÒÑ¾­¹ıÈ¥¶à³¤Ê±¼ä
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º2016Äê5ÔÂ14ÈÕ16:13:40
***************************************************************************************************/
unsigned int timer_used(Timer *t)
{
	if(t)
	{
		return (GB_ClockTime - t->start);
	}
	else
		return 0;
}

/***************************************************************************************************
*FunctionName£ºtimer_Count
*Description£º¾àÀë¶¨Ê±Æ÷¿ªÊ¼ÒÑ¾­¹ıÁË¶à³¤Ê±¼ä£¬ÎŞÂÛÊ±¼äÊÇ·ñµ½´ï
*Input£ºNone
*Output£ºNone
*Author£ºxsx
*Data£º
***************************************************************************************************/
unsigned int timer_Count(Timer * t)
{
	if(t)
		return (GB_ClockTime - t->start);
	else
		return 0;
}

/***************************************************************************************************
*FunctionName: timerIsStartted
*Description: ÅĞ¶Ï¶¨Ê±Æ÷ÊÇ·ñÒÑ¾­Æô¶¯
*Input: 
*Output: 
*Return: 
*Author: xsx
*Date: 2016Äê12ÔÂ8ÈÕ16:27:47
***************************************************************************************************/
bool timerIsStartted(Timer * t)
{
	if(t)
	{
		if(t->start == 0)
			return false;
		else
			return true;
	}
	
	return false;
}

/***************************************************************************************************
*FileName: ReadBarCode_Fun.c
*Description:
*Author: xsx_kair
*Data:
***************************************************************************************************/

/***************************************************************************************************/
/******************************************Header List********************************************/
/***************************************************************************************************/
#include	"ReadBarCode_Fun.h"
#include	"MyTools.h"
#include	"Usart1_Driver.h"
#include	"QueueUnits.h"

#include	<string.h>
#include	"stdio.h"
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
static unsigned short rxlen = 0;
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/****************************************File Start*************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************
*FunctionName: ReadBarCodeFunction
*Description: 读取条码枪的数据
*Input: codebuf -- 数据保存地址
*		len -- 要读取的数据长度
*Output: 
*Return: 成功读取数据的长度
*Author: xsx
*Date: 2016年12月16日16:00:36
***************************************************************************************************/
unsigned char ReadBarCodeFunction(char * codebuf, unsigned char len)
{
	rxlen = 0;
	
	if(codebuf)
	{
		ReceiveDataFromQueue(GetUsart1RXQueue(), NULL, codebuf, len, &rxlen, 1, 10 / portTICK_RATE_MS, FreeRTOSZeroDelay, 100 / portTICK_RATE_MS);
		
		if(rxlen > 0)
		{
			clearStringEndWord(codebuf, rxlen);
			rxlen = strlen(codebuf);
		}
	}
	
	return rxlen;
}

void clearBarCodeQueue(void)
{
	xQueueReset(GetUsart1RXQueue());
}


/****************************************end of file************************************************/

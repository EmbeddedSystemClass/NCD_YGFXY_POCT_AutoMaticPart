/***************************************************************************************************
*FileName:
*Description:
*Author: xsx_kair
*Data:
***************************************************************************************************/

/***************************************************************************************************/
/******************************************Header List********************************************/
/***************************************************************************************************/
#include	"Motor1_Fun.h"

#include	"Motor1_Driver.h"
#include	"Timer3_Driver.h"

#include	"Delay.h"

#include 	"FreeRTOS.h"
#include 	"task.h"
#include 	"queue.h"
#include	"semphr.h"

#include	<string.h>
#include	"stdio.h"
#include 	"stdlib.h"
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
static Motor * motor1 = NULL;
static bool motor1StopMovePermission = false;
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/****************************************File Start*************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************
*FunctionName: motor1StartMove
*Description: 电机1开始运动N步
*Input:  isFront -- 是否往前走
*		stepNum -- 走的步数
*		waitTime -- 等待时间
*Output: 
*Return: 
*Author: xsx
*Date: 2017年8月10日 14:12:21
***************************************************************************************************/
void motor1MoveToNum(unsigned char num, bool isWait)
{
	motor1 = getMotor(Motor_1);

	if(motor1->motorLocation == num)
		return;
	
	motor1->periodCnt = 0;
	motor1->motorTargetLocation = num;
	motor1->moveStepNum = 650000;
	motor1->parm1 = 0;
	motor1StopMovePermission = false;
	
	while(isWait && motor1->motorLocation != motor1->motorTargetLocation)
	{
		vTaskDelay(100 / portTICK_RATE_MS);
		if(motor1StopMovePermission)
		{
			motor1->moveStepNum = 0;
			break;
		}
	}
}

void motor1StopMove(void)
{
	motor1StopMovePermission = true;
}


/****************************************end of file************************************************/


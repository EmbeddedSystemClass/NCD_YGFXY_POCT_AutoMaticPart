/***************************************************************************************************
*FileName: Motor3_Fun
*Description: 控制爪子整体移动
*Author: xsx_kair
*Data: 2017年7月20日 15:29:33
***************************************************************************************************/

/***************************************************************************************************/
/******************************************Header List********************************************/
/***************************************************************************************************/
#include	"Motor3_Fun.h"

#include	"Motor3_Driver.h"

#include	"Delay.h"

#include 	"FreeRTOS.h"
#include 	"task.h"
#include 	"queue.h"
#include	"semphr.h"

#include	<string.h>
#include	"stdio.h"
#include 	"stdlib.h"
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
static Motor * motor3 = NULL;
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/****************************************File Start*************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************
*FunctionName:  resetToOriginLocation
*Description:   回原点
*Input:  
*Output:  
*Return:  
*Author:  xsx
*Date:  2017年7月20日 15:59:48
***************************************************************************************************/
void motor3MoveTo(unsigned short location, unsigned short waitTime)
{
	motor3 = getMotor(Motor_3);

	if(motor3->motorLocation == location)
		return;
	else if(motor3->motorLocation > location)
		motor3->isFront = false;
	else
		motor3->isFront = true;

	if(motor3->isFront)
		setMotor3DirGPIO(ON);
	else
		setMotor3DirGPIO(OFF);
	delay_ms(5);
	
	motor3->periodCnt = 0;
	motor3->motorTargetLocation = location;
	
	if(motor3->isFront)
		motor3->moveStepNum = (motor3->motorTargetLocation - motor3->motorLocation);
	else
		motor3->moveStepNum = (motor3->motorLocation - motor3->motorTargetLocation);
	
	while(waitTime-- && (motor3->motorLocation != motor3->motorTargetLocation))
	{
		vTaskDelay(1 / portTICK_RATE_MS);
	}
}

void motor3GotoOriginLocation(unsigned short waitTime)
{
	motor3 = getMotor(Motor_3);
	
	motor3->motorLocation = 65000;
	
	motor3MoveTo(0, waitTime);
}

/****************************************end of file************************************************/

